<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Data</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');
        @import url('https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined');

        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
            background-color: rgba(46, 46, 46, 1);
            color: white;
        }
        .container {
            max-width: 800px; /* Increase the max-width */
            margin: 50px auto;
            padding: 20px;
            background-color: rgba(57, 57, 57, 1); /* Dark gray background */
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(57, 57, 57, 1);
            color: #ffffff; /* White text */
            border: 2px solid #ffffff; /* Make the border bolder */
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .option-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .option-container label {
            margin-right: 20px;
            font-size: 16px;
            cursor: pointer;
        }
        input[type="file"], input[type="url"] {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            display: none;
        }
        .drag-file-area {
            border: 4px dashed #ffffff; /* White border */
            border-radius: 40px;
            margin: 40px 0 60px; /* Increase top and bottom margins */
            width: 100%; /* Update width to 100% */
            text-align: center;
            color: #ffffff; /* White text */
            background-color: rgba(57, 57, 57, 1); /* Black background */
            display: none;
        }
        .drag-file-area .upload-icon {
            font-size: 50px;
        }
        .drag-file-area h3 {
            font-size: 26px;
            margin: 15px 0;
        }
        .drag-file-area label {
            font-size: 19px;
        }
        .drag-file-area label .browse-files-text {
            color: #000000;
            font-weight: bolder;
            cursor: pointer;
        }
        .cannot-upload-message {
            background-color: #ffc6c4;
            font-size: 17px;
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 5px 10px 5px 30px;
            border-radius: 5px;
            color: #BB0000;
            display: none;
        }
        @keyframes fadeIn {
            0% {opacity: 0;}
            100% {opacity: 1;}
        }
        .cannot-upload-message span, .upload-button-icon {
            padding-right: 10px;
        }
        .cannot-upload-message span:last-child {
            padding-left: 20px;
            cursor: pointer;
        }
        .file-block {
            color: #f7fff7;
            background-color: #000000;
            transition: all 1s;
            width: 100%;
            position: relative;
            display: none;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0 15px;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
        }
        .file-info {
            display: flex;
            align-items: center;
            font-size: 15px;
        }
        .file-icon {
            margin-right: 10px;
        }
        .file-name, .file-size {
            padding: 0 3px;
        }
        .remove-file-icon {
            cursor: pointer;
        }
        .progress-bar {
            display: flex;
            position: absolute;
            bottom: 0;
            left: 4.5%;
            width: 0;
            height: 5px;
            border-radius: 25px;
            background-color: #4BB543;
        }
        .upload-button {
            font-family: 'Montserrat';
            background-color: rgba(7, 7, 7, 0.8);
            color: #f7fff7;
            display: flex;
            align-items: center;
            justify-content: center; /* Center horizontally */
            font-size: 18px;
            border: none;
            border-radius: 20px;
            margin: 10px auto; /* Center horizontally */
            padding: 7.5px 50px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Upload Data</h1>
        <form id="upload-form" enctype="multipart/form-data" method="POST">
            <div class="option-container">
                <input type="radio" id="file-option" name="upload-option" value="file" checked>
                <label for="file-option">Upload File</label>
                <input type="radio" id="url-option" name="upload-option" value="url">
                <label for="url-option">Upload from URL</label>
            </div>
            <input type="file" id="file" name="file" accept=".csv" required>
            <input type="url" id="url" name="url" placeholder="Enter URL">
            <div class="drag-file-area" id="drag-file-area">
                <span class="material-icons-outlined upload-icon">file_upload</span>
                <h3 class="dynamic-message">Drag & drop .csv file here</h3>
                <!-- <label class="label">or <span class="browse-files"><input type="file" class="default-file-input" />  <span>from device</span></span></label> -->
            </div>
            <span class="cannot-upload-message"><span class="material-icons-outlined">error</span> Please select a file first <span class="material-icons-outlined cancel-alert-button">cancel</span></span>
            <div class="file-block">
                <div class="file-info"><span class="material-icons-outlined file-icon">description</span> <span class="file-name"></span> | <span class="file-size"></span></div>
                <span class="material-icons remove-file-icon">delete</span>
                <div class="progress-bar"></div>
            </div>
            <button type="submit" class="upload-button">Upload</button>
        </form>
    </div>

    <script>
        const fileOption = document.getElementById('file-option');
        const urlOption = document.getElementById('url-option');
        const fileInput = document.getElementById('file');
        const urlInput = document.getElementById('url');
        const dragFileArea = document.getElementById('drag-file-area');
        const form = document.getElementById('upload-form');
        const cannotUploadMessage = document.querySelector(".cannot-upload-message");
        const cancelAlertButton = document.querySelector(".cancel-alert-button");
        const uploadedFile = document.querySelector(".file-block");
        const fileName = document.querySelector(".file-name");
        const fileSize = document.querySelector(".file-size");
        const progressBar = document.querySelector(".progress-bar");
        const removeFileButton = document.querySelector(".remove-file-icon");
        const uploadButton = document.querySelector(".upload-button");

        fileOption.addEventListener('change', () => {
            if (fileOption.checked) {
                fileInput.style.display = 'block';
                urlInput.style.display = 'none';
                dragFileArea.style.display = 'block';
                fileInput.required = true;
                urlInput.required = false;
            }
        });

        urlOption.addEventListener('change', () => {
            if (urlOption.checked) {
                fileInput.style.display = 'none';
                urlInput.style.display = 'block';
                dragFileArea.style.display = 'none';
                fileInput.required = false;
                urlInput.required = true;
            }
        });

        fileInput.addEventListener("click", () => {
            fileInput.value = '';
            console.log(fileInput.value);
        });

        fileInput.addEventListener("change", e => {
            console.log(" > " + fileInput.value)
            const uploadIcon = document.querySelector(".upload-icon");
            const dragDropText = document.querySelector(".dynamic-message");
            uploadIcon.innerHTML = 'check_circle';
            dragDropText.innerHTML = 'File Dropped Successfully!';
            document.querySelector(".label").innerHTML = `drag & drop or <span class="browse-files"><input type="file" class="default-file-input" /> <span class="browse-files-text" style="top: 0;">browse file</span></span>`;
            uploadButton.innerHTML = `Upload`;
            fileName.innerHTML = fileInput.files[0].name;
            fileSize.innerHTML = (fileInput.files[0].size / 1024).toFixed(1) + " KB";
            uploadedFile.style.cssText = "display: flex;";
            progressBar.style.width = 0;
        });

        uploadButton.addEventListener("click", async (event) => {
            event.preventDefault();
            let isFileUploaded = fileInput.value || urlInput.value;
            if (isFileUploaded) {
                if (fileInput.value) {
                    var width = 0;
                    var id = setInterval(frame, 50);
                    function frame() {
                        if (width >= 390) {
                            clearInterval(id);
                            uploadButton.innerHTML = `<span class="material-icons-outlined upload-button-icon">check_circle</span> Uploaded`;
                        } else {
                            width += 5;
                            progressBar.style.width = width + "px";
                        }
                    }

                    // Upload the file
                    const formData = new FormData(form);
                    try {
                        const response = await fetch('/upload-csv-data', {
                            method: 'POST',
                            body: formData
                        });
                        if (response.ok) {
                            const data = await response.json();
                            alert(data.message);
                        } else {
                            alert('Upload failed');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                    }
                }
            } else {
                cannotUploadMessage.style.cssText = "display: flex; animation: fadeIn linear 1.5s;";
            }
        });

        cancelAlertButton.addEventListener("click", () => {
            cannotUploadMessage.style.cssText = "display: none;";
        });

        removeFileButton.addEventListener("click", () => {
            uploadedFile.style.cssText = "display: none;";
            fileInput.value = '';
            const uploadIcon = document.querySelector(".upload-icon");
            const dragDropText = document.querySelector(".dynamic-message");
            uploadIcon.innerHTML = 'file_upload';
            dragDropText.innerHTML = 'Drag & drop any file here';
            document.querySelector(".label").innerHTML = `or <span class="browse-files"><input type="file" class="default-file-input" /><span class="browse-files-text">browse file</span><span>from device</span></span>`;
            uploadButton.innerHTML = `Upload`;
        });

        var isAdvancedUpload = function () {
            var div = document.createElement('div');
            return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;
        }();

        if (isAdvancedUpload) {
            ["drag", "dragstart", "dragend", "dragover", "dragenter", "dragleave", "drop"].forEach(evt =>
                dragFileArea.addEventListener(evt, e => {
                    e.preventDefault();
                    e.stopPropagation();
                })
            );

            ["dragover", "dragenter"].forEach(evt => {
                dragFileArea.addEventListener(evt, e => {
                    e.preventDefault();
                    e.stopPropagation();
                    const uploadIcon = document.querySelector(".upload-icon");
                    const dragDropText = document.querySelector(".dynamic-message");
                    uploadIcon.innerHTML = 'file_download';
                    dragDropText.innerHTML = 'Drop your file here!';
                });
            });

            dragFileArea.addEventListener("drop", e => {
                const uploadIcon = document.querySelector(".upload-icon");
                const dragDropText = document.querySelector(".dynamic-message");
                uploadIcon.innerHTML = 'check_circle';
                dragDropText.innerHTML = 'File Dropped Successfully!';
                document.querySelector(".label").innerHTML = `drag & drop or <span class="browse-files"><input type="file" class="default-file-input" style="" /><span class="browse-files-text" style="top: -23px; left: -20px;">browse file</span></span>`;
                uploadButton.innerHTML = `Upload`;

                let files = e.dataTransfer.files;
                fileInput.files = files;
                console.log(files[0].name + " " + files[0].size);
                console.log(document.querySelector(".default-file-input").value);
                fileName.innerHTML = files[0].name;
                fileSize.innerHTML = (files[0].size / 1024).toFixed(1) + " KB";
                uploadedFile.style.cssText = "display: flex;";
                progressBar.style.width = 0;
            });
        }
    </script>
</body>
</html>
